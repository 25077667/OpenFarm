<div ng-app="showGuidesApp"
     ng-controller="showGuideCtrl"
     ng-cloak
     class="show-guide-app">

    <alert ng-cloak class="ng-cloak columns large-6 centered" ng-repeat="alert in alerts" type="alert.type" close="closeAlert($index)">
      <div class="">
        {{alert.msg}}
      </div>
    </alert>

    <div class="row">
    <form accept-charset="UTF-8"
      class="small-10 large-10 columns centered edit-overview"
      name="edit-overview"
      method="post"
      >
      <div class="column large-10">
        <h1> {{ guide.name }} </h1>
      </div>

      <div class="columns large-3">
        <img ng-src="{{ guide.featured_image }}" ng-attr-alt="{{ guide.name }}"/>
        <p>
          <%= link_to(icon('edit') + " Edit Guide", {:action => 'edit'}, :class=>'edit-link') %>
        </p>
      </div>
      <div class="columns large-9">
        <p>
          {{ guide.overview }}
        </p>
      </div>

    </form>
    </div>
    <div class="row">
    <div class="large-10 small-10 columns centered">

    <accordion close-others="false">
      <accordion-group is-open="false" class="accordion-navigation statistics">
        <accordion-heading class="title-wrapper">
          <h2 class="title">
            <i ng-class="{'fa fa-chevron-down': isopen, 'fa fa-chevron-right': !isopen}"></i>
            Statistics
          </h2>
        </accordion-heading>
        <p class="section-text">
        This guide has had <%= pluralize(@guide.impressions.count, 'view') %>
        </p>
      </accordion-group>
      <accordion-group is-open="true" class="accordion-navigation requirements">
        <accordion-heading class="title-wrapper">
          <h2 class="title">
            <i ng-class="{'fa fa-chevron-down': isopen, 'fa fa-chevron-right': !isopen}"></i>
            Requirements
          </h2>
        </accordion-heading>
        <p class="section-text">
          Requirements are the small details that make sure this crop grows successfully.
        </p>
        <div class="box">
          <div class="row">
            <div class="small-12 columns actual-requirements">
            </div>
          </div>
          <div class="row requirements-results">
            <div class="small-6 columns centered">
              <span ng-show="filtered_requirements.length > 0">
                You've selected: <br/> <span ng-repeat="r in (guide.requirements | filter: {active: !r.active }) as filtered_requirements"> {{r.name}}<span ng-if="!$last">,</span>
                </span>
              </span>
            </div>
          </div>
        </div>
      </accordion-group>

      <accordion-group is-open="true" class="accordion-navigation">
        <accordion-heading class="title-wrapper">
          <h2 class="title" id="stages">
            <i ng-class="{'fa fa-chevron-down': isOpen, 'fa fa-chevron-right': !isOpen}"></i>
            Stages
          </h2>

        </accordion-heading>
        <p class="section-text">
          Each stage of growing this crop, with details.
        </p>
        <tabset class="tabs">

          <tab ng-repeat="s in guide.stages | orderBy:'order'">
            <tab-heading href="#instructions-{{ s.slug }}" class="tab-heading">
              <h3>{{ s.name }}</h3>
            </tab-heading>
            <div class="box">
              <div class="row">
                <div class="columns large-12 stage-description">
                  <p>{{ s.description }}</p>
                  <textarea placeholder="{{ s.default_value }}"
                    ng-model="s.instructions"
                    ng-change="setStatus(s)">
                  </textarea>
                </div>
              </div>
            </div>
          </tab>
        </tabset>
      </accordion-group>
    </accordion>
    </div>
  </div>
</div>

<%= javascript_tag "var GUIDE_ID = '#{@guide.try(:id).to_s}';" %>

