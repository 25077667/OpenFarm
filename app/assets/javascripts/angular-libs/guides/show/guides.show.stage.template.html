<div class="row stage">
  <!-- <div class="columns small-6 medium-4 action-photos stage-wrapper"
    ng-class="{end: $last}">
    <div ng-if="stage.pictures[0].image_url"
        class="stage-option {{stage.name}}"
        style="background-image: url({{stage.pictures[0].image_url}})"
        ng-class="{stage.name : stage.pictures.length === 0}" for="{{ stage.name }}">
    </div>
    <div ng-if="!stage.pictures[0].image_url">
      No image yet.
    </div>
  </div> -->

  <div class="management-actions" ng-if="canEdit">

    <a ng-hide="editingStage"
      class="button tiny secondary edit-link"
      ng-click="toggleEditingStage()">
      <i class="fa fa-edit"></i> Edit Stage
    </a>
    <a ng-hide="editingStage"
      class="button tiny secondary edit-link"
      ng-click="deleteStage(stage)">
      <i class="fa fa-trash"></i> Delete Stage
    </a>
    <a ng-show="editingStage"
      class="button tiny primary edit-link"
      ng-click="saveStageChanges(stage)">
      <i class="fa fa-save"></i> Save Changes To Stage
    </a>
  </div>

  <div class="columns images"
    ng-class="{ 'small-3': stage.pictures.length === 0 }">
    <span ng-repeat="pic in stage.pictures"
      ng-if="!editingStage">
      <a of-lightbox-modal="pic"
         description="$parent.name"></a>
    </span>
    <span ng-if="stage.pictures.length === 0"
      class="stage-default-picture stage-option {{ stage.name | lowercase }}">
    </span>

    <div class="upload-stage-picture"
        s3-upload
        bucket="s3Bucket"
        ng-model="s3upload"
        s3-upload-existing-pictures="stage.pictures"
        s3-upload-place-pic="placeImageUpload(image)"
        s3-upload-options="{getOptionsUri: '/api/aws/s3_access_token', folder: 'temp/'}"
        ng-show="editingStage">
    </div>
  </div>

  <div class="columns small-8 action-content end"
    ng-class="{ 'small-12': stage.pictures.length > 0 }">
    <h4 class="stage-name">{{ stage.name }} Overview</h4>

    <div class="row" ng-hide="editingStage">
      <div class="markdown columns small-8"
        markdown="stage.overview"
        ng-if="stage.overview"
        >
      </div>
      <div ng-hide="stage.overview"
        class="columns small-8 empty-details">
        <p>No stage overview given</p>
      </div>
    </div>
    <textarea
      ng-model="stage.overview"
      ng-show="editingStage">
    </textarea>

    <table ng-hide="editingStage">
      <tr>
        <th>Environment</th><td>
          <span of-environmental-overview="environment"></span>
        </td>
      </tr>
      <tr>
        <th>Light</th><td>
          <span of-environmental-overview="light"></span>
        </td>
      </tr>
      <tr>
        <th>Soil</th><td><span of-environmental-overview="soil"></span></td>
      </tr>
    </table>

    <div ng-show="editingStage">

      <label>Environment</label>
      <div multi-row-select
           class="multi-choice"
           relative-id="'stage' + stage.id"
           options-array="environment"
           multi-select-overflow-count="3"
           multi-select-type="checkbox"
           multi-select-id="environment">
      </div>

      <label>Light</label>
      <div multi-row-select
           class="multi-choice"
           relative-id="'stage' + stage.id"
           options-array="light"
           multi-select-overflow-count="3"
           multi-select-type="checkbox"
           multi-select-id="light">
      </div>

      <label>Soil</label>
      <div multi-row-select
           class="multi-choice"
           relative-id="'stage' + stage.id"
           options-array="soil"
           multi-select-overflow-count="3"
           multi-select-type="checkbox"
           multi-select-id="soil">
      </div>
    </div>
  </div>

  <div class="columns small-12 action-content"
    ng-class="{end: $last}"
    ng-repeat="action in stage.stage_actions">
    <h4 class="action-name" ng-bind="action.name"></h4>
    <span ng-repeat="picture in action.pictures">
      <a of-lightbox-modal="picture" description="$parent.name"></a>
    </span>
    <div class="row">
      <p class="action-description columns small-8"
        ng-bind="action.overview">
      </p>
    </div>
    <p ng-show="action.time" class="action-time">This stage took <span ng-bind="action.time"></span> minutes.</p>
  </div>
</div>
